<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inpatient Care</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gray-100 p-6">
    <div class="space-y-6 max-w-6xl mx-auto" id="inpatientPage">
        <!-- Header -->
        <div class="flex items-center space-x-4">
            <button onclick="window.history.back()" class="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg">
                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
            </button>
            <div>
                <h1 class="text-3xl font-bold text-gray-900">Inpatient Care</h1>
                <p class="text-gray-600">Follow up on doctor's treatment plans</p>
            </div>
        </div>

        <!-- Error Message -->
        <div id="errorMessage" class="hidden rounded-md bg-red-50 p-4">
            <div class="text-sm text-red-700" id="errorText"></div>
        </div>

        <!-- Main Content -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Inpatient Cases List -->
            <div class="bg-white rounded-lg shadow-sm border p-6" id="casesList">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Inpatient Cases (<span id="caseCount">0</span>)</h3>
                <div class="space-y-3" id="casesContainer">
                    <!-- Populated by JavaScript -->
                </div>
            </div>

            <!-- Case Details and Care Update Form -->
            <div class="lg:col-span-2 space-y-6" id="caseDetailsSection">
                <!-- Placeholder for no selection -->
                <div id="noSelection" class="bg-white rounded-lg shadow-sm border p-12 text-center">
                    <svg class="h-12 w-12 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                    </svg>
                    <h3 class="text-lg font-medium text-gray-900 mb-2">Select a Case</h3>
                    <p class="text-gray-600">Choose an inpatient case to provide care updates</p>
                </div>

                <!-- Treatment Plan -->
                <div id="treatmentPlan" class="hidden bg-white rounded-lg shadow-sm border p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4" id="patientNameHeader"></h3>
                    <div class="space-y-4">
                        <div>
                            <h4 class="font-medium text-gray-900 mb-2">Diagnosis</h4>
                            <p class="text-sm text-gray-700 bg-gray-50 p-3 rounded-md" id="diagnosis"></p>
                        </div>
                        <div>
                            <h4 class="font-medium text-gray-900 mb-2">Treatment Plan</h4>
                            <p class="text-sm text-gray-700 bg-gray-50 p-3 rounded-md" id="treatmentPlanText"></p>
                        </div>
                        <div id="medicationsSection" class="hidden">
                            <h4 class="font-medium text-gray-900 mb-2">Medications</h4>
                            <p class="text-sm text-gray-700 bg-gray-50 p-3 rounded-md" id="medications"></p>
                        </div>
                        <div id="followUpSection" class="hidden">
                            <h4 class="font-medium text-gray-900 mb-2">Follow-up Instructions</h4>
                            <p class="text-sm text-gray-700 bg-gray-50 p-3 rounded-md" id="followUp"></p>
                        </div>
                    </div>
                </div>

                <!-- Care Update Form -->
                <form id="careUpdateForm" class="hidden bg-white rounded-lg shadow-sm border p-6 space-y-6">
                    <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                        <svg class="h-5 w-5 mr-2 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                        </svg>
                        Care Update
                    </h3>

                    <!-- Care Provided -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Care Provided</label>
                        <textarea id="careProvided" rows="3" required placeholder="Describe the care provided according to treatment plan..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>

                    <!-- Patient Response -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Patient Response</label>
                        <textarea id="patientResponse" rows="3" required placeholder="How did the patient respond to treatment?" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>

                    <!-- Medications Administered -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Medications Administered</label>
                        <textarea id="medicationsAdministered" rows="2" placeholder="List medications given and times..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>

                    <!-- Updated Vital Signs -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Updated Vital Signs</label>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <input type="text" id="bloodPressure" placeholder="Blood Pressure" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <input type="text" id="pulse" placeholder="Pulse" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <input type="text" id="temperature" placeholder="Temperature" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <input type="text" id="weight" placeholder="Weight" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>

                    <!-- Additional Notes -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Additional Notes</label>
                        <textarea id="additionalNotes" rows="3" placeholder="Any additional observations or concerns..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>

                    <!-- Ready for Discharge -->
                    <div class="border-t pt-4">
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" id="readyForDischarge" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <span class="text-sm font-medium text-gray-700">Patient is ready for discharge</span>
                        </label>
                    </div>

                    <!-- Submit Button -->
                    <div class="flex justify-end pt-4">
                        <button type="submit" id="submitButton" class="flex items-center space-x-2 px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50">
                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span id="submitText">Update Care Record</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // State management
            let inpatientCases = [];
            let selectedCase = null;
            let isLoading = false;
            let error = '';
            let careUpdate = {
                care_provided: '',
                patient_response: '',
                medications_administered: '',
                vital_signs_update: {
                    blood_pressure: '',
                    pulse: '',
                    temperature: '',
                    weight: ''
                },
                notes: '',
                ready_for_discharge: false
            };

            // DOM elements
            const errorMessage = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');
            const caseCount = document.getElementById('caseCount');
            const casesContainer = document.getElementById('casesContainer');
            const caseDetailsSection = document.getElementById('caseDetailsSection');
            const noSelection = document.getElementById('noSelection');
            const treatmentPlan = document.getElementById('treatmentPlan');
            const patientNameHeader = document.getElementById('patientNameHeader');
            const diagnosis = document.getElementById('diagnosis');
            const treatmentPlanText = document.getElementById('treatmentPlanText');
            const medicationsSection = document.getElementById('medicationsSection');
            const medications = document.getElementById('medications');
            const followUpSection = document.getElementById('followUpSection');
            const followUp = document.getElementById('followUp');
            const careUpdateForm = document.getElementById('careUpdateForm');
            const careProvided = document.getElementById('careProvided');
            const patientResponse = document.getElementById('patientResponse');
            const medicationsAdministered = document.getElementById('medicationsAdministered');
            const bloodPressure = document.getElementById('bloodPressure');
            const pulse = document.getElementById('pulse');
            const temperature = document.getElementById('temperature');
            const weight = document.getElementById('weight');
            const additionalNotes = document.getElementById('additionalNotes');
            const readyForDischarge = document.getElementById('readyForDischarge');
            const submitButton = document.getElementById('submitButton');
            const submitText = document.getElementById('submitText');

            // Mock fetch inpatient cases
            function fetchInpatientCases() {
                // Simulate API call with mock data
                const mockCases = [
                    {
                        id: '1',
                        patient_name: 'John Doe',
                        patient_id: 'ID123',
                        diagnosis: 'Hypertension',
                        treatment_plan: 'Monitor BP, administer medication',
                        medications: 'Amlodipine 5mg daily',
                        follow_up_instructions: 'Check BP every 4 hours',
                        doctor_name: 'Dr. Smith',
                        created_at: '2025-09-24',
                        status: 'ongoing_care'
                    },
                    {
                        id: '2',
                        patient_name: 'Jane Smith',
                        patient_id: 'ID456',
                        diagnosis: 'Diabetes',
                        treatment_plan: 'Insulin therapy',
                        medications: 'Insulin 10 units',
                        follow_up_instructions: 'Monitor glucose levels',
                        doctor_name: 'Dr. Jones',
                        created_at: '2025-09-23',
                        status: 'ongoing_care'
                    }
                ];
                inpatientCases = mockCases;
                populateCases();
            }

            // Populate cases list
            function populateCases() {
                caseCount.textContent = inpatientCases.length;
                casesContainer.innerHTML = '';
                inpatientCases.forEach(case_ => {
                    const div = document.createElement('div');
                    div.className = `p-3 rounded-lg border cursor-pointer transition-colors ${selectedCase?.id === case_.id ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300'}`;
                    div.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-2">
                                <svg class="h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                </svg>
                                <span class="font-medium text-sm">${case_.patient_name}</span>
                            </div>
                            <span class="px-2 py-1 text-xs rounded-full ${case_.status === 'ongoing_care' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800'}">${case_.status.replace(/_/g, ' ')}</span>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Dr. ${case_.doctor_name}</p>
                    `;
                    div.addEventListener('click', () => setSelectedCase(case_));
                    casesContainer.appendChild(div);
                });
                if (inpatientCases.length === 0) {
                    casesContainer.innerHTML = '<p class="text-gray-500 text-sm">No inpatient cases</p>';
                }
                updateSections();
            }

            // Update sections visibility and content
            function updateSections() {
                if (selectedCase) {
                    noSelection.classList.add('hidden');
                    treatmentPlan.classList.remove('hidden');
                    careUpdateForm.classList.remove('hidden');
                    patientNameHeader.textContent = `Treatment Plan - ${selectedCase.patient_name}`;
                    diagnosis.textContent = selectedCase.diagnosis;
                    treatmentPlanText.textContent = selectedCase.treatment_plan;
                    if (selectedCase.medications) {
                        medicationsSection.classList.remove('hidden');
                        medications.textContent = selectedCase.medications;
                    } else {
                        medicationsSection.classList.add('hidden');
                    }
                    if (selectedCase.follow_up_instructions) {
                        followUpSection.classList.remove('hidden');
                        followUp.textContent = selectedCase.follow_up_instructions;
                    } else {
                        followUpSection.classList.add('hidden');
                    }
                    updateInputs();
                } else {
                    noSelection.classList.remove('hidden');
                    treatmentPlan.classList.add('hidden');
                    careUpdateForm.classList.add('hidden');
                }
            }

            // Update input values
            function updateInputs() {
                careProvided.value = careUpdate.care_provided;
                patientResponse.value = careUpdate.patient_response;
                medicationsAdministered.value = careUpdate.medications_administered;
                bloodPressure.value = careUpdate.vital_signs_update.blood_pressure;
                pulse.value = careUpdate.vital_signs_update.pulse;
                temperature.value = careUpdate.vital_signs_update.temperature;
                weight.value = careUpdate.vital_signs_update.weight;
                additionalNotes.value = careUpdate.notes;
                readyForDischarge.checked = careUpdate.ready_for_discharge;
            }

            // Handle input changes
            careProvided.addEventListener('input', (e) => { careUpdate.care_provided = e.target.value; });
            patientResponse.addEventListener('input', (e) => { careUpdate.patient_response = e.target.value; });
            medicationsAdministered.addEventListener('input', (e) => { careUpdate.medications_administered = e.target.value; });
            bloodPressure.addEventListener('input', (e) => { careUpdate.vital_signs_update.blood_pressure = e.target.value; });
            pulse.addEventListener('input', (e) => { careUpdate.vital_signs_update.pulse = e.target.value; });
            temperature.addEventListener('input', (e) => { careUpdate.vital_signs_update.temperature = e.target.value; });
            weight.addEventListener('input', (e) => { careUpdate.vital_signs_update.weight = e.target.value; });
            additionalNotes.addEventListener('input', (e) => { careUpdate.notes = e.target.value; });
            readyForDischarge.addEventListener('change', (e) => { careUpdate.ready_for_discharge = e.target.checked; });

            // Handle form submission
            careUpdateForm.addEventListener('submit', (e) => {
                e.preventDefault();
                if (!selectedCase) return;

                setIsLoading(true);
                error = '';
                errorMessage.classList.add('hidden');
                submitText.textContent = 'Updating...';
                submitButton.disabled = true;

                // Simulate API post
                setTimeout(() => {
                    const updateData = {
                        case_id: selectedCase.id,
                        ...careUpdate,
                        status: careUpdate.ready_for_discharge ? 'ready_for_discharge' : 'ongoing_care'
                    };
                    console.log('Submitting:', updateData); // Mock API call
                    localStorage.setItem('careUpdate', JSON.stringify(updateData)); // Simulate storage
                    inpatientCases = inpatientCases.map(c => c.id === selectedCase.id ? { ...c, status: updateData.status } : c);
                    setSelectedCase(null);
                    careUpdate = {
                        care_provided: '',
                        patient_response: '',
                        medications_administered: '',
                        vital_signs_update: { blood_pressure: '', pulse: '', temperature: '', weight: '' },
                        notes: '',
                        ready_for_discharge: false
                    };
                    alert('Care update submitted successfully!');
                    populateCases();
                }, 1000); // Simulate loading delay

                // Reset state
                setIsLoading(false);
                submitText.textContent = careUpdate.ready_for_discharge ? 'Mark Ready for Discharge' : 'Update Care Record';
                submitButton.disabled = false;
            });

            // Initialize
            fetchInpatientCases();

            function setIsLoading(value) {
                isLoading = value;
                submitButton.disabled = isLoading;
            }

            function setError(message) {
                error = message;
                if (error) {
                    errorText.textContent = error;
                    errorMessage.classList.remove('hidden');
                } else {
                    errorMessage.classList.add('hidden');
                }
            }

            function setSelectedCase(case_) {
                selectedCase = case_;
                updateSections();
                updateInputs();
            }
        });
    </script>
</body>
</html>