<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Registration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .healthcare-heading { font-size: 1.25rem; font-weight: 600; }
        .healthcare-input { @apply border-gray-300 focus:ring-blue-500 focus:border-blue-500; }
        .healthcare-form { border-color: #e5e7eb; }
        .bg-primary { background-color: #3b82f6; }
        .hover:bg-primary-dark { background-color: #2563eb; }
        .bg-primary-light { background-color: #dbeafe; }
        .bg-secondary { background-color: #9333ea; }
        .bg-secondary-accent { color: #9333ea; }
        .bg-accent { background-color: #8b5cf6; }
        .bg-accent-light { background-color: #ede9fe; }
        .bg-warning { background-color: #f59e0b; }
        .text-muted-foreground { color: #6b7280; }
    </style>
</head>
<body class="min-h-screen bg-gray-100 p-6 flex flex-row">
    <nav class="w-64 bg-surface shadow-lg border-r border-gray-200">
        <div class="p-6 border-b border-gray-200">
            <h1 class="text-xl font-bold text-primary">Nurse Dashboard</h1>
            <p class="text-sm text-secondary mt-1">EHR System</p>
        </div>
        
        <div class="p-4">
            <ul class="space-y-2">
                <li>
                    <a href="/nurse/dashboard/" class="flex items-center p-3 rounded-lg bg-primary text-white">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path>
                        </svg>
                        Dashboard
                    </a>
                </li>
                <li>
                    <a href="/nurse/registration/all/" class="flex items-center p-3 rounded-lg text-secondary hover:bg-gray-100 transition-colors">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
                        </svg>
                        Patient Registration
                    </a>
                </li>
                <li>
                    <a href="/nurse/attend/" class="flex items-center p-3 rounded-lg text-secondary hover:bg-gray-100 transition-colors">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                        Attend to Patients
                    </a>
                </li>
                <li>
                    <a href="/nurse/inpatient/" class="flex items-center p-3 rounded-lg text-secondary hover:bg-gray-100 transition-colors">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                        </svg>
                        Inpatient Care
                    </a>
                </li>
                <li>
                    <a href="/nurse/reports/" class="flex items-center p-3 rounded-lg text-secondary hover:bg-gray-100 transition-colors">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        Reports
                    </a>
                </li>
            </ul>
        </div>
    </nav>


    <div class="max-w-6xl mx-auto space-y-6" id="app">
        <!-- Header -->
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">Patient Registration <span class="text-red-800">{{patient.first_name}} {{patient.last_name}}</span> <span class="text-red-800 bold">{{patient.id_no}}</span></h1> 
                <p class="text-gray-600">Register new patients and add initial medical information </p> 
            </div>
        </div>

        <!-- Form -->
        <form method="post" action="/nurse/registration/each/{{patient.id}}/" id="registrationForm" class="space-y-6">
            {% csrf_token %}
            <!-- Basic Information -->
            <!-- <div class="bg-white rounded-lg shadow healthcare-form">
                <div class="p-6 border-b">
                    <h2 class="flex items-center gap-2 healthcare-heading">
                        <svg class="h-5 w-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
                        </svg>
                        Basic Information
                    </h2>
                </div>
                <div class="p-6 space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-700">Full Name *</label>
                            <input id="name" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label for="age" class="block text-sm font-medium text-gray-700">Age *</label>
                            <input id="age" type="number" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="gender" class="block text-sm font-medium text-gray-700">Gender *</label>
                            <select id="gender" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Select gender</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div>
                            <label for="contact" class="block text-sm font-medium text-gray-700">Contact Number *</label>
                            <input id="contact" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>

                    <div>
                        <label for="emergencyContact" class="block text-sm font-medium text-gray-700">Emergency Contact</label>
                        <input id="emergencyContact" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
            </div> -->

            <!-- Vital Signs -->
            <div class="bg-white rounded-lg shadow healthcare-form">
                <div class="p-6 border-b">
                    <h2 class="flex items-center gap-2 healthcare-heading">
                        <svg class="h-5 w-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z" />
                        </svg>
                        Vital Signs
                    </h2>
                </div>
                <div class="p-6 space-y-4">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div>
                            <label for="bp" class="block text-sm font-medium text-gray-700">B/P *</label>
                            <input id="bp" name="bp" type="number" step="0.1" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label for="pulse" class="block text-sm font-medium text-gray-700">Pulse (bpm) *</label>
                            <input id="pulse" name="pulse" type="number" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label for="weight" class="block text-sm font-medium text-gray-700">Weight (kg) *</label>
                            <input id="weight" type="number" name="weight" step="0.1" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label for="height" class="block text-sm font-medium text-gray-700">Height (cm) *</label>
                            <input id="height" type="number" name="height" step="0.1" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label for="urinealb" class="block text-sm font-medium text-gray-700">urinealb </label>
                            <input id="urinealb" name="urinealb" type="number" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label for="urinesugar" class="block text-sm font-medium text-gray-700">urinesugar </label>
                            <input id="urinesugar" name="urinesugar" type="number"  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                    </div>
                </div>
            </div>

            <!-- Diagnosis & Admission -->
            <!-- <div class="bg-white rounded-lg shadow healthcare-form">
                <div class="p-6 border-b">
                    <h2 class="flex items-center gap-2 healthcare-heading">
                        <svg class="h-5 w-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                        </svg>
                        Diagnosis & Admission
                    </h2>
                </div>
                <div class="p-6 space-y-4">
                    <div>
                        <label for="diagnosis" class="block text-sm font-medium text-gray-700">Diagnosis *</label>
                        <textarea id="diagnosis" rows="3" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="admissionDate" class="block text-sm font-medium text-gray-700">Admission Date</label>
                            <input id="admissionDate" type="date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label for="dischargeDate" class="block text-sm font-medium text-gray-700">Planned Discharge Date</label>
                            <input id="dischargeDate" type="date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                </div>
            </div> -->

            <!-- Medical History -->
            <div class="bg-white rounded-lg shadow healthcare-form">
                <div class="p-6 border-b">
                    <h2 class="flex items-center gap-2 healthcare-heading">
                        <svg class="h-5 w-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V7a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        Medical History
                    </h2>
                </div>
                <div class="p-6 space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="medicalHistoryContainer">
                        <!-- Populated by JavaScript -->
                         {% for disease in diseases %}
                         <div class="flex items-center space-x-2">
                            <input type="checkbox" name="disease-{{disease}}" id="disease-{{disease}}" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <label for="disease-{{disease}}" class="text-sm">{{disease}}</label>
                        </div>
                        {% endfor %}
                        
                    </div>

                    <!-- <div class="flex gap-2">
                        <input id="customDisease" placeholder="Add custom disease/condition" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <button type="button" id="addCustomDisease" class="px-3 py-2 border border-gray-300 rounded-md hover:bg-gray-100">Add</button>
                    </div> -->
                </div>
            </div>

            <!-- Submit Button -->
            <div class="flex justify-end">
                <button id="submitButton" type="submit" class="px-8 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50">
                    Register Patient
                </button>
            </div>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Mock types and utilities
            const Patient = {
                id: String,
                name: String,
                age: Number,
                gender: String,
                contact: String,
                emergencyContact: String,
                vitals: Array,
                diagnosis: String,
                admissionDate: String,
                dischargeDate: String,
                medicalHistory: Array,
                complaints: Array,
                nurseNotes: Array,
                careProvided: Array,
                patientResponse: Array,
                medications: Array,
                fluidChart: Array,
                observationNotes: Array,
                createdAt: String,
                updatedAt: String
            };
            const Vitals = {
                temperature: Number,
                pulse: Number,
                respiration: Number,
                systolic: Number,
                diastolic: Number,
                weight: Number,
                height: Number,
                timestamp: String
            };
            const MedicalHistory = {
                disease: String,
                hasDisease: Boolean
            };

            function generateId() {
                return 'xxxx-xxxx-xxx'.replace(/x/g, () => (Math.random() * 16 | 0).toString(16));
            }

            // Mock storage
            const patientStorage = {
                save: (patient) => {
                    const stored = localStorage.getItem('patients') ? JSON.parse(localStorage.getItem('patients')) : [];
                    stored.push(patient);
                    localStorage.setItem('patients', JSON.stringify(stored));
                }
            };

            // State
            let isSubmitting = false;
            let basicInfo = { name: "", age: "", gender: "", contact: "", emergencyContact: "" };
            let vitals = { temperature: "", pulse: "", respiration: "", systolic: "", diastolic: "", weight: "", height: "" };
            let admission = { diagnosis: "", admissionDate: "", dischargeDate: "" };
            let medicalHistory = [
                { disease: "Diabetes", hasDisease: false },
                { disease: "Hypertension", hasDisease: false },
                { disease: "Heart Disease", hasDisease: false },
                { disease: "Asthma", hasDisease: false },
                { disease: "Allergies", hasDisease: false }
            ];
            let customDisease = "";

            // DOM elements
            const name = document.getElementById('name');
            const age = document.getElementById('age');
            const gender = document.getElementById('gender');
            const contact = document.getElementById('contact');
            const emergencyContact = document.getElementById('emergencyContact');
            const temperature = document.getElementById('temperature');
            const pulse = document.getElementById('pulse');
            const respiration = document.getElementById('respiration');
            const weight = document.getElementById('weight');
            const systolic = document.getElementById('systolic');
            const diastolic = document.getElementById('diastolic');
            const height = document.getElementById('height');
            const diagnosis = document.getElementById('diagnosis');
            const admissionDate = document.getElementById('admissionDate');
            const dischargeDate = document.getElementById('dischargeDate');
            const medicalHistoryContainer = document.getElementById('medicalHistoryContainer');
            const customDiseaseInput = document.getElementById('customDisease');
            const addCustomDisease = document.getElementById('addCustomDisease');
            const submitButton = document.getElementById('submitButton');
            const registrationForm = document.getElementById('registrationForm');

            // Update state from inputs
            name.addEventListener('input', (e) => { basicInfo.name = e.target.value; });
            age.addEventListener('input', (e) => { basicInfo.age = e.target.value; });
            gender.addEventListener('change', (e) => { basicInfo.gender = e.target.value; });
            contact.addEventListener('input', (e) => { basicInfo.contact = e.target.value; });
            emergencyContact.addEventListener('input', (e) => { basicInfo.emergencyContact = e.target.value; });
            temperature.addEventListener('input', (e) => { vitals.temperature = e.target.value; });
            pulse.addEventListener('input', (e) => { vitals.pulse = e.target.value; });
            respiration.addEventListener('input', (e) => { vitals.respiration = e.target.value; });
            weight.addEventListener('input', (e) => { vitals.weight = e.target.value; });
            systolic.addEventListener('input', (e) => { vitals.systolic = e.target.value; });
            diastolic.addEventListener('input', (e) => { vitals.diastolic = e.target.value; });
            height.addEventListener('input', (e) => { vitals.height = e.target.value; });
            diagnosis.addEventListener('input', (e) => { admission.diagnosis = e.target.value; });
            admissionDate.addEventListener('change', (e) => { admission.admissionDate = e.target.value; });
            dischargeDate.addEventListener('change', (e) => { admission.dischargeDate = e.target.value; });
            customDiseaseInput.addEventListener('input', (e) => { customDisease = e.target.value; });

            // Populate medical history checkboxes
            function populateMedicalHistory() {
                medicalHistoryContainer.innerHTML = '';
                medicalHistory.forEach((history, index) => {
                    const div = document.createElement('div');
                    div.className = 'flex items-center space-x-2';
                    div.innerHTML = `
                        <input type="checkbox" id="disease-${index}" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                        <label for="disease-${index}" class="text-sm">${history.disease}</label>
                    `;
                    const checkbox = div.querySelector('input');
                    checkbox.checked = history.hasDisease;
                    checkbox.addEventListener('change', () => {
                        medicalHistory[index].hasDisease = checkbox.checked;
                    });
                    medicalHistoryContainer.appendChild(div);
                });
            }

            // Add custom disease
            addCustomDisease.addEventListener('click', () => {
                if (customDisease.trim()) {
                    medicalHistory.push({ disease: customDisease.trim(), hasDisease: true });
                    customDisease = "";
                    customDiseaseInput.value = "";
                    populateMedicalHistory();
                }
            });

            // Handle form submission
            registrationForm.addEventListener('submit', (e) => {
                e.preventDefault();
                isSubmitting = true;
                submitButton.textContent = 'Registering...';
                submitButton.disabled = true;

                try {
                    if (!basicInfo.name || !basicInfo.age || !basicInfo.gender || !basicInfo.contact) {
                        throw new Error("Please fill in all required basic information fields");
                    }

                    if (!vitals.temperature || !vitals.pulse || !vitals.respiration || 
                        !vitals.systolic || !vitals.diastolic || !vitals.weight || !vitals.height) {
                        throw new Error("Please fill in all vital signs");
                    }

                    if (!admission.diagnosis) {
                        throw new Error("Please provide a diagnosis");
                    }

                    const patientVitals = {
                        temperature: parseFloat(vitals.temperature),
                        pulse: parseInt(vitals.pulse),
                        respiration: parseInt(vitals.respiration),
                        systolic: parseInt(vitals.systolic),
                        diastolic: parseInt(vitals.diastolic),
                        weight: parseFloat(vitals.weight),
                        height: parseFloat(vitals.height),
                        timestamp: new Date().toISOString()
                    };

                    const patient = {
                        id: generateId(),
                        name: basicInfo.name,
                        age: parseInt(basicInfo.age),
                        gender: basicInfo.gender,
                        contact: basicInfo.contact,
                        emergencyContact: basicInfo.emergencyContact,
                        vitals: [patientVitals],
                        diagnosis: admission.diagnosis,
                        admissionDate: admission.admissionDate || undefined,
                        dischargeDate: admission.dischargeDate || undefined,
                        medicalHistory: medicalHistory.filter(mh => mh.hasDisease),
                        complaints: [],
                        nurseNotes: [],
                        careProvided: [],
                        patientResponse: [],
                        medications: [],
                        fluidChart: [],
                        observationNotes: [],
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };

                    patientStorage.save(patient);

                    alert(`Patient Registered Successfully\n${patient.name} has been registered in the system.`);

                    basicInfo = { name: "", age: "", gender: "", contact: "", emergencyContact: "" };
                    vitals = { temperature: "", pulse: "", respiration: "", systolic: "", diastolic: "", weight: "", height: "" };
                    admission = { diagnosis: "", admissionDate: "", dischargeDate: "" };
                    medicalHistory = medicalHistory.map(mh => ({ ...mh, hasDisease: false }));
                    customDisease = "";
                    name.value = "";
                    age.value = "";
                    gender.value = "";
                    contact.value = "";
                    emergencyContact.value = "";
                    temperature.value = "";
                    pulse.value = "";
                    respiration.value = "";
                    weight.value = "";
                    systolic.value = "";
                    diastolic.value = "";
                    height.value = "";
                    diagnosis.value = "";
                    admissionDate.value = "";
                    dischargeDate.value = "";
                    populateMedicalHistory();
                    customDiseaseInput.value = "";
                } catch (error) {
                    alert(`Registration Failed\n${error instanceof Error ? error.message : 'An error occurred'}`);
                } finally {
                    isSubmitting = false;
                    submitButton.textContent = 'Register Patient';
                    submitButton.disabled = false;
                }
            });

            // Initialize
            populateMedicalHistory();
        });
    </script>
</body>
</html>